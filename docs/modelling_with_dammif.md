---
title: Modelling with DAMMIF
author: Normand Cyr
date: 2019-07-03
...

Several softwares described here are also available on [ATSAS online](https://www.embl-hamburg.de/biosaxs/atsas-online/) (registration required).


# Dummy atoms bead modelling with DAMMIF

Dummy atoms bead modelling is used to generate 3D models corresponding to experimental SAXS data.

![](img/dammin_example.png)

Source: [Mertens and Svergun 2010](https://www.ncbi.nlm.nih.gov/pubmed/20558299)

Citing the manual of DAMMIF, the general process goes as follow:

> In bead modeling a particle is represented as a collection of a large number of densely packed beads inside a search volume. Each bead belongs either to the particle or to the solvent. Starting from an arbitrary initial model DAMMIF utilizes simulated annealing to construct a compact interconnected model yielding a scattering pattern that fits the experimental data.

More details, and the official manual for ATSAS DAMMIF can be found [here](https://www.embl-hamburg.de/biosaxs/manuals/dammif.html).


## Overview of the process

![](img/process_flow.png)

Source: [Franke 2012](https://www.embl-hamburg.de/biosaxs/courses/embo2012/slides/ab-initio-tutorial-franke.pdf)


## Initial DAMMIF calculations

DAMMIF uses the GNOM output file (the distance distribution function) as the main input file. It has two modes of operation (fast - large beads and slow - small beads) as well as an interactive mode (invoked by running only `dammif` without arguments).

The general command is

```bash
dammif --mode=fast RMA.out
```

This will output a single bead model in PDB format along with a log file and numerical files containing fits to the experimental data. Generally speaking, it is common to calculation multiple models and then average the similar ones. This is done using a `for` loop in a `bash` script (see below).


Below is a typical `bash` script to determine 20 models simultaneously, in slow mode:

```bash
#!/bin/bash

# Variables used
GNOM_FILE_PREFIX="RMA"
MODE="slow"
NB_CALC=20

# Loop for the program
for i in `seq 1 $NB_CALC`
do
  dammif ${GNOM_FILE_PREFIX}.out --prefix=${GNOM_FILE_PREFIX}-${i} --mode=$MODE &
done
```

## Averaging and filtering

A series of softwares are available for selecting the most similar models (DAMSEL), aligning the selected models (DAMSUP), averaging them (DAMAVER) and then filtering to a cut-off volume (DAMFILT). A complete manual is available [online](https://www.embl-hamburg.de/biosaxs/manuals/damaver.html).


### Exclusion of significantly different models with DAMSEL

DAMSEL selects the most probable models from a series of bead models generated by DAMMIF (or [GASBOR](https://www.embl-hamburg.de/biosaxs/manuals/gasbor.html)) and identifies outliers using [SUPCOMB](https://www.embl-hamburg.de/biosaxs/manuals/supcomb.html), a software used for the superposition of PDB models. The models are scored using a normalized spatial discrepancy (NSD). The SUPCOMB manual describes the process in the following terms:

> Briefly, if two three-dimensional models are represented as a set of points, for every point in the first set (model 1), the minimum value among the distances between this point and all points in the second set (model 2) is found, and the same is done for the points in the second set. These distances are added and normalized against the average distances between the neighboring points for the two sets.

For well superimposed models, NSD will gets toward 0, whereare a NSD above 1 corresponds to models systematically different. With DAMSEL, models which NSD exceeds 2 standard deviations from the mean of the group of models are labelled as excluded.

The general command is

```bash
damsel RMA-1-1.pdb RMA-2-1.pdb RMA-3-1.pdb RMA-4-1.pdb
```

By default, the results will be written in the `damsel.log` log file, with the following format:

```markdown
Recommendation       NSD  File
       Include     1.131  RMA-1-1.pdb
       Include     1.133  RMA-2-1.pdb
       Include     1.148  RMA-3-1.pdb
       Exclude     2.453  RMA-4-1.pdb
```

Below is a typical `bash` script to run DAMSEL:

```bash
#!/bin/bash

# Variables used
DAMMIF_PREFIX="RMA"
OUTPUT_LOGFILE="damsel.log"

damsel ${DAMMIF_PREFIX}-*-1.pdb -o $OUTPUT_LOGFILE
```


### Alignment of selected models with DAMSUP

Using the list of included models output by DAMSEL, the next step is to align the models to a reference one (typically the first one). This is done using DAMSUP via the following command:

```bash
damsup damsel.log
```

Alternatively, a list of PDB files may be given:

```bash
damsup RMA-1-1.pdb RMA-2-1.pdb RMA-3-1.pdb
```

The letter `r` is added at the end of the file names for structures that were aligned to a reference. A table giving the NSD to the reference will be saved in `damsup.log`:

```markdown
NSD  Filename
0.000  RMA-1-1.pdb
1.097  RMA-2-1r.pdb
1.120  RMA-3-1r.pdb
```


### Averaging with DAMAVER

DAMAVER will then take the aligned models from DAMSUP (using the output log file) and calculate a probability map. The software writes this frequency per atom as occupancy in the output file, `damaver.pdb`.

```bash
damaver damsup.log
```

The output average model can further be filtered using DAMFILT at a given cut-off volume. Therefore, low occupancy and poorly connected atoms are removed. The cut-off volume used is the averaged volume of the models if available, or half the input volume otherwise.

```bash
damfilt damaver.pdb
```


## Refinement of the model using DAMMIN

The filtered model generally do not fit well the experimental data. It is therefore highly recommended to refine the model against the experimental data using DAMMIN. To do this, a starting model has to be generated with DAMSTART:

```bash
damstart damaver.pdb
```

This generates a fixed core model (`damstart.pdb`) that will be used as an initial approximation, instead of starting the modelling with a sphere with a diameter of \(D_{max}\). For refinement purposes, DAMMIN has to be run in interactive mode (run the command `dammin` alone) where each parameter is entered one by one. Line-by-line answers may be saved in advance in a text file and input (`<`) into the `dammin` command (more details [here](https://www.saxier.org/forum/viewtopic.php?f=8&t=412) and [here](https://www.saxier.org/forum/viewtopic.php?f=8&t=3044)).

```bash
dammin < answers.txt
```

The complete manual for DAMMIN can be found [here](https://www.embl-hamburg.de/biosaxs/dammin.html).


## Visualization of the models

Suggestions are provided on the SAXIER forum:

* Pymol: [here](https://www.saxier.org/forum/viewtopic.php?f=8&t=350) and [here](https://www.saxier.org/forum/viewtopic.php?f=11&t=3102)
* Chimera: [here](https://www.saxier.org/forum/viewtopic.php?f=8&t=1075)
